CREATE TABLE [dbo].[vDDCL]
(
[KeyID] [int] NOT NULL IDENTITY(1, 1),
[Culture] [varchar] (15) COLLATE Latin1_General_BIN NOT NULL
) ON [PRIMARY]
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE TRIGGER [dbo].[vtDDCLd_Audit] ON [dbo].[vDDCL]
 AFTER DELETE
 NOT FOR REPLICATION AS
 SET NOCOUNT ON 
 -- generated by vspHQCreateAuditTriggers on May 14 2009  9:56AM

 BEGIN TRY 
   INSERT dbo.vDDChangeLog (TableName, KeyString, Action, FieldName, OldValue, NewValue, DateTime, MachineName, CommandText)
   SELECT 'vDDCL' , '<KeyString CultureID = "' + REPLACE(CAST(deleted.Culture AS VARCHAR(MAX)),'"', '&quot;') + '" />' , 'D' , NULL , NULL , NULL , GETDATE() , HOST_NAME() , 'DELETE FROM vDDCL WHERE Culture = ''' + CAST(deleted.Culture AS VARCHAR(MAX)) + ''''
	FROM deleted
 END TRY 
 BEGIN CATCH 
   RAISERROR('Error in [dbo].[dbo.vtDDCLi_Audit] trigger', 16, 1 ) with log
 END CATCH 
GO
EXEC sp_settriggerorder N'[dbo].[vtDDCLd_Audit]', 'last', 'delete', null
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE TRIGGER [dbo].[vtDDCLi_Audit] ON [dbo].[vDDCL]
 AFTER INSERT
 NOT FOR REPLICATION AS
 SET NOCOUNT ON 
 -- generated by vspHQCreateAuditTriggers on May 14 2009  9:56AM

 BEGIN TRY 
   INSERT dbo.vDDChangeLog (TableName, KeyString, Action, FieldName, OldValue, NewValue, DateTime, MachineName, CommandText)
   SELECT 'vDDCL' , '<KeyString CultureID = "' + REPLACE(CAST(inserted.Culture AS VARCHAR(MAX)),'"', '&quot;') + '" />' , 'A' , NULL , NULL , NULL , GETDATE() , HOST_NAME() , 'INSERT INTO dbo.[vDDCL] ([Culture]) VALUES (' + ISNULL('''' + REPLACE(CAST(Culture AS NVARCHAR(MAX)), '''' , '''''') + '''', 'NULL')  + ')'
	FROM inserted
 END TRY 
 BEGIN CATCH 
   RAISERROR('Error in [dbo].[dbo.vtDDCLi_Audit] trigger', 16, 1 ) with log
 END CATCH 
GO
EXEC sp_settriggerorder N'[dbo].[vtDDCLi_Audit]', 'last', 'insert', null
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE TRIGGER [dbo].[vtDDCLu_Audit] ON [dbo].[vDDCL]
 AFTER UPDATE 
 NOT FOR REPLICATION AS 
 SET NOCOUNT ON 
 -- generated by vspHQCreateAuditTriggers on May 14 2009  9:56AM

 BEGIN TRY 
 IF UPDATE([Culture])
   INSERT dbo.vDDChangeLog (TableName, KeyString, Action, FieldName, OldValue, NewValue, DateTime, MachineName, CommandText)
   SELECT 'vDDCL' , '<KeyString CultureID = "' + REPLACE(CAST(inserted.Culture AS VARCHAR(MAX)),'"', '&quot;') + '" />' , 'U' , 'Culture' ,  CONVERT(VARCHAR(MAX), deleted.[Culture]) ,  Convert(VARCHAR(MAX), inserted.[Culture]) , GETDATE() , HOST_NAME() , 'UPDATE vDDCL SET Culture = ''' + ISNULL(REPLACE(Convert(VARCHAR(MAX), inserted.[Culture]), '''' , ''''''), 'NULL') + ''' WHERE Culture = ''' + CAST(inserted.Culture AS VARCHAR(MAX)) + ''''
		FROM inserted
			INNER JOIN deleted
         ON  inserted.[Culture] = deleted.[Culture] 
         AND ISNULL(inserted.[Culture],'') <> ISNULL(deleted.[Culture],'')

 END TRY 
 BEGIN CATCH 
   RAISERROR('Error in [dbo].[dbo.vtDDCLi_Audit] trigger', 16, 1 ) with log
 END CATCH 
GO
EXEC sp_settriggerorder N'[dbo].[vtDDCLu_Audit]', 'last', 'update', null
GO
ALTER TABLE [dbo].[vDDCL] ADD CONSTRAINT [PK_vDDCL] PRIMARY KEY CLUSTERED  ([KeyID], [Culture]) WITH (FILLFACTOR=90) ON [PRIMARY]
GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_vDDCL_KeyID] ON [dbo].[vDDCL] ([KeyID]) WITH (FILLFACTOR=90) ON [PRIMARY]
GO
